#!/bin/bash

function huong_dan(){
T√≠nh nƒÉng Ki·ªÉm tra dung l∆∞·ª£ng m√£ ngu·ªìn website trong WPTangToc OLS l√† m·ªôt c√¥ng c·ª• cho ph√©p b·∫°n x√°c ƒë·ªãnh t·ªïng k√≠ch th∆∞·ªõc [dung l∆∞·ª£ng ·ªï c·ª©ng] m√† c√°c t·ªáp v√† th∆∞ m·ª•c c·ªßa m·ªôt website c·ª• th·ªÉ ƒëang chi·∫øm d·ª•ng tr√™n m√°y ch·ªß.

üéØ M·ª•c ƒë√≠ch ch√≠nh c·ªßa t√≠nh nƒÉng n√†y:
 * Qu·∫£n l√Ω T√†i nguy√™n ·ªî c·ª©ng: Gi√∫p b·∫°n theo d√µi xem m·ªói website ƒëang s·ª≠ d·ª•ng bao nhi√™u dung l∆∞·ª£ng, ƒë·∫∑c bi·ªát quan tr·ªçng n·∫øu b·∫°n c√≥ gi·ªõi h·∫°n v·ªÅ ·ªï c·ª©ng ho·∫∑c qu·∫£n l√Ω nhi·ªÅu website tr√™n c√πng m·ªôt m√°y ch·ªß.
 * Ph√°t hi·ªán Th√†nh ph·∫ßn L·ªõn: C√≥ th·ªÉ gi√∫p b·∫°n nh·∫≠n bi·∫øt n·∫øu m·ªôt website c√≥ dung l∆∞·ª£ng m√£ ngu·ªìn b·∫•t th∆∞·ªùng, c√≥ th·ªÉ do themes/plugins n·∫∑ng, ho·∫∑c c√°c t·ªáp kh√¥ng c·∫ßn thi·∫øt.
 * H·ªó tr·ª£ T·ªëi ∆∞u h√≥a: L√† b∆∞·ªõc ƒë·∫ßu ƒë·ªÉ xem x√©t vi·ªác d·ªçn d·∫πp, x√≥a b·ªè c√°c t·ªáp, themes, plugins kh√¥ng s·ª≠ d·ª•ng nh·∫±m gi·∫£i ph√≥ng kh√¥ng gian.
 * L·∫≠p k·∫ø ho·∫°ch Sao l∆∞u/Di chuy·ªÉn: Bi·∫øt ƒë∆∞·ª£c dung l∆∞·ª£ng m√£ ngu·ªìn gi√∫p ∆∞·ªõc t√≠nh th·ªùi gian v√† kh√¥ng gian c·∫ßn thi·∫øt cho vi·ªác sao l∆∞u ho·∫∑c di chuy·ªÉn website.

T√≥m l·∫°i, t√≠nh nƒÉng n√†y trong WPTangToc OLS cung c·∫•p m·ªôt c√°ch nhanh ch√≥ng v√† ti·ªán l·ª£i ƒë·ªÉ b·∫°n ki·ªÉm so√°t dung l∆∞·ª£ng m√† ph·∫ßn m√£ ngu·ªìn c·ªßa c√°c website ƒëang chi·∫øm d·ª•ng tr√™n m√°y ch·ªß, h·ªó tr·ª£ vi·ªác qu·∫£n l√Ω v√† t·ªëi ∆∞u h√≥a t√†i nguy√™n hi·ªáu qu·∫£.
}


NAME=$1
if [[ $NAME = "98" ]];then
	NAME=""
fi
if [[ $NAME = "" ]];then
	echo ""
	echo ""
	echo ""
	echo "========================================================================="
	echo "|Qu·∫£n l√Ω disk => Ki·ªÉm tra dung l∆∞·ª£ng m√£ ngu·ªìn website                   |"
	echo "========================================================================="
	echo ""
	. /etc/wptt/tenmien-them-lua-chon-tat-ca-website
	echo ""
	echo ""
	echo "L·ª±a ch·ªçn website b·∫°n mu·ªën ki·∫øm tra dung l∆∞·ª£ng m√£ ngu·ªìn: "
	echo ""
	lua_chon_NAME
fi


if [[ $NAME = 'T·∫•t c·∫£ website' ]];then
	if [ "$(ls -A /etc/wptt/vhost| grep -v '^\.\.conf$' | sort -uV)" ]; then
		for entry in $(ls -A /etc/wptt/vhost|sort -uV); do
			domain=$(echo $entry | sed 's/^.//' | sed 's/.conf//')
			path="/usr/local/lsws/$domain/html"
			i=1
			if [[ -d "$path" ]]; then
				echo "==================================================================="
				echo "$domain ƒëang s·ª≠ d·ª•ng ·ªï c·ª©ng: "
				kiemtra_dung_luong=$(du -hs $path | sed 's/\t//g'| cut -f1 -d '/')
				echo "Dung l∆∞·ª£ng m√£ ngu·ªìn website $domain l√† ${kiemtra_dung_luong}B"
			fi
			if [[ -d /usr/local/backup-website/$domain && $(ls /usr/local/backup-website/$domain | grep ".zip$\|.sql$\|.sql.gz$") ]];then
				kiemtra_dung_luong_backup=$(du -hs /usr/local/backup-website/$domain | sed 's/\t//g'| cut -f1 -d '/')
				echo "Dung l∆∞·ª£ng backup c·ªßa website $domain l√† ${kiemtra_dung_luong_backup}B"
			fi

			if [[ -d $path/wp-content/plugins/litespeed-cache && -d /usr/local/lsws/$domain/luucache ]];then
				kiemtra_dung_luong_cache=$(du -hs /usr/local/lsws/$domain/luucache | sed 's/\t//g'| cut -f1 -d '/')
				echo "Dung l∆∞·ª£ng cache LScache c·ªßa website $domain l√† ${kiemtra_dung_luong_cache}B"
			fi

			if [[ -d /usr/local/lsws/$domain/logs ]];then
				kiemtra_dung_luong_logs=$(du -hs /usr/local/lsws/$domain/logs | sed 's/\t//g'| cut -f1 -d '/')
				echo "Dung l∆∞·ª£ng logs c·ªßa website $domain l√† ${kiemtra_dung_luong_logs}B"
			fi

			. /etc/wptt/vhost/.$domain.conf
			if [[ -d /var/lib/mysql/$DB_Name_web ]];then
				kiemtra_dung_luong_db=$(du -hs /var/lib/mysql/$DB_Name_web | sed 's/\t//g'| cut -f1 -d '/')
				if [[ $(echo $kiemtra_dung_luong_db |grep 'K') = '' ]];then
					echo "Dung l∆∞·ª£ng database c·ªßa website $domain l√† ${kiemtra_dung_luong_db}B"
				fi
			fi
			echo "==================================================================="
		done

		check_menu_wptangtoc_active=$1
		if [[ $check_menu_wptangtoc_active = "98" ]];then
			. /etc/wptt/wptt-disk-main 1
		fi
		exit
	fi
fi


if [[ "$NAME" = "0" || "$NAME" = "" ]]; then
	. /etc/wptt/wptt-ma-nguon-main 1
fi

pathcheck="/etc/wptt/vhost/.$NAME.conf"
if [[ ! -f "$pathcheck" ]]; then
	clear
	echoDo "T√™n mi·ªÅn kh√¥ng t·ªìn t·∫°i tr√™n h·ªá th·ªëng n√†y"
	sleep 3
	. /etc/wptt/wptt-disk-main 1
	exit
fi


path="/usr/local/lsws/$NAME/html"
i=1
if [[ -d "$path" ]]; then
	echo "==================================================================="
	echo "website $NAME ƒëang s·ª≠ d·ª•ng ·ªï c·ª©ng: "
	kiemtra_dung_luong=$(du -hs $path | sed 's/\t//g'| cut -f1 -d '/')
	echo "Dung l∆∞·ª£ng m√£ ngu·ªìn website $domain l√† ${kiemtra_dung_luong}B"
fi
if [[ -d /usr/local/backup-website/$domain && $(ls /usr/local/backup-website/$domain | grep ".zip$\|.sql$\|.sql.gz$") ]];then
	kiemtra_dung_luong_backup=$(du -hs /usr/local/backup-website/$domain | sed 's/\t//g'| cut -f1 -d '/')
	echo "Dung l∆∞·ª£ng backup c·ªßa website $domain l√† ${kiemtra_dung_luong_backup}B"
fi

if [[ -d $path/wp-content/plugins/litespeed-cache && -d /usr/local/lsws/$domain/luucache ]];then
	kiemtra_dung_luong_cache=$(du -hs /usr/local/lsws/$domain/luucache | sed 's/\t//g'| cut -f1 -d '/')
	echo "Dung l∆∞·ª£ng cache LScache c·ªßa website $domain l√† ${kiemtra_dung_luong_cache}B"
fi

if [[ -d /usr/local/lsws/$domain/logs ]];then
	kiemtra_dung_luong_logs=$(du -hs /usr/local/lsws/$domain/logs | sed 's/\t//g'| cut -f1 -d '/')
	echo "Dung l∆∞·ª£ng logs c·ªßa website $domain l√† ${kiemtra_dung_luong_logs}B"
fi

. /etc/wptt/vhost/.$NAME.conf
if [[ -d /var/lib/mysql/$DB_Name_web ]];then
	kiemtra_dung_luong_db=$(du -hs /var/lib/mysql/$DB_Name_web | sed 's/\t//g'| cut -f1 -d '/')
	if [[ $(echo $kiemtra_dung_luong_db |grep 'K') = '' ]];then
		echo "Dung l∆∞·ª£ng database c·ªßa website $domain l√† ${kiemtra_dung_luong_db}B"
	fi
fi

check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]];then
	. /etc/wptt/wptt-disk-main 1
fi


