#!/bin/bash
# @author: Gia Tu·∫•n
# @website: https://wptangtoc.com
# @email: giatuan@wptangtoc.com
# @since: 2025

function huong_dan() {
  T√≠nh nƒÉng Qu·∫£n l√Ω C·∫≠p nh·∫≠t [Update Management] trong WPTangToc OLS l√† m·ªôt ch·ª©c nƒÉng c·ªët l√µi gi√∫p b·∫°n d·ªÖ d√†ng n√¢ng c·∫•p b·∫£n th√¢n script WPTangToc OLS, Webserver, Linux... l√™n phi√™n b·∫£n m·ªõi nh·∫•t. üöÄ

  Gi·ªõi thi·ªáu ng·∫Øn g·ªçn:

  M·ª•c ƒë√≠ch: ƒê·∫£m b·∫£o b·∫°n lu√¥n s·ª≠ d·ª•ng phi√™n b·∫£n m·ªõi nh·∫•t, ƒëi k√®m v·ªõi c√°c b·∫£n v√° l·ªói, c·∫£i ti·∫øn hi·ªáu su·∫•t, t√≠nh nƒÉng m·ªõi ƒë∆∞·ª£c b·ªï sung, v√† c√°c c·∫≠p nh·∫≠t t∆∞∆°ng th√≠ch ho·∫∑c b·∫£o m·∫≠t li√™n quan ƒë·∫øn vi·ªác qu·∫£n l√Ω m√°y ch·ªß.

  C√°ch ho·∫°t ƒë·ªông:
  * WPTangToc OLS cung c·∫•p m·ªôt l·ªánh ho·∫∑c t√πy ch·ªçn trong menu ch√≠nh c·ªßa n√≥.
  * script s·∫Ω ki·ªÉm tra phi√™n b·∫£n m·ªõi nh·∫•t t·ª´ ngu·ªìn ph√°t h√†nh ch√≠nh th·ª©c v√† ti·∫øn h√†nh t·∫£i v·ªÅ, c√†i ƒë·∫∑t b·∫£n c·∫≠p nh·∫≠t.

  L·ª£i √≠ch:
  * An to√†n v√† ·ªïn ƒë·ªãnh: Lu√¥n nh·∫≠n ƒë∆∞·ª£c c√°c b·∫£n v√° l·ªói v√† c·∫≠p nh·∫≠t b·∫£o m·∫≠t m·ªõi nh·∫•t cho ch√≠nh c√¥ng c·ª• qu·∫£n l√Ω.
  * T√≠nh nƒÉng m·ªõi: Ti·∫øp c·∫≠n s·ªõm c√°c c√¥ng c·ª• v√† t√πy ch·ªçn qu·∫£n l√Ω m√°y ch·ªß ti√™n ti·∫øn.
  * Hi·ªáu su·∫•t t·ªëi ∆∞u: H∆∞·ªüng l·ª£i t·ª´ c√°c c·∫£i ti·∫øn gi√∫p script ho·∫°t ƒë·ªông hi·ªáu qu·∫£ h∆°n.
  * Ti·ªán l·ª£i: Qu√° tr√¨nh c·∫≠p nh·∫≠t th∆∞·ªùng ƒë∆∞·ª£c t·ª± ƒë·ªông h√≥a, gi√∫p b·∫°n ti·∫øt ki·ªám th·ªùi gian v√† c√¥ng s·ª©c.
  Vi·ªác th∆∞·ªùng xuy√™n s·ª≠ d·ª•ng t√≠nh nƒÉng n√†y ƒë·ªÉ c·∫≠p nh·∫≠t WPTangToc OLS l√† r·∫•t quan tr·ªçng ƒë·ªÉ duy tr√¨ m·ªôt m√¥i tr∆∞·ªùng qu·∫£n l√Ω m√°y ch·ªß hi·ªán ƒë·∫°i, an to√†n v√† hi·ªáu qu·∫£.
}

if [[ $1 = "" ]]; then
  . /etc/wptt/wptt-header-menu
  header_menu
else
  . /etc/wptt/echo-color
  echoDo "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-="
fi

. /etc/wptt/.wptt.conf
if [[ $ngon_ngu = '' ]]; then
  ngon_ngu='vi'
fi
. /etc/wptt/lang/$ngon_ngu.sh

echo ""
echo ""
echo "$quan_ly_update:"
echo ""
options=(
  "$update_wptangtoc_ols"                       #1
  "$cap_nhat_toan_bo_webserver"                 #2
  "$cap_nhat WP CLI"                            #5
  "$kich_hoat_tu_dong_update_wptangtoc_ols"     #6
  "$tat_kich_hoat_tu_dong_update_wptangtoc_ols" #7
  "$kiem_tra_phien_ban_cac_service"             #8
  "$cap_nhat PhpMyAdmin"                        #9
  "$chuyen_nhanh_wptangtoc_ols_chinh_thuc"      #10
  "$chuyen_nhanh_wptangtoc_ols_beta"            #11
)

# H√†m th·ª±c thi h√†nh ƒë·ªông d·ª±a tr√™n index (cho menu Qu·∫£n l√Ω Update)
run_action() {
  local index=$1
  local script_path=""
  local arg1="" # Tham s·ªë th·ª© nh·∫•t
  local arg2="" # Tham s·ªë th·ª© hai (n·∫øu c√≥)

  case $index in
  0)
    script_path="/etc/wptt/wptt-update"
    arg1="98"
    ;;
  1)
    script_path="/etc/wptt/update/wptt-update-he-thong"
    arg1="98"
    ;;
  2)
    script_path="/etc/wptt/update/wptt-wp-cli"
    arg1="98"
    ;;
  3)
    script_path="/etc/wptt/update/wptt-auto-update"
    arg1="98"
    ;;
  4)
    script_path="/etc/wptt/update/wptt-tat-auto-update"
    arg1="98"
    ;;
  5)
    script_path="/etc/wptt/update/wptt-kiem-tra-version"
    arg1="99" #d√πng 99 ƒë·ªÉ ph√¢n bi·ªát lu·ªìng menu t·ª´ menu update hay serivce
    ;;
  6)
    script_path="/etc/wptt/update/wptt-update-phpmyadmin"
    arg1="98"
    ;;
  7)
    script_path="/etc/wptt/wptt-update2"
    arg1="chinhthuc"
    arg2="98"
    ;; # Tham s·ªë ƒë·∫∑c bi·ªát
  8)
    script_path="/etc/wptt/wptt-update2"
    arg1="beta"
    arg2="98"
    ;; # Tham s·ªë ƒë·∫∑c bi·ªát
  *)
    echo "${lua_chon_khong_hop_le:-L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá}: Index $index."
    return 1
    ;;
  esac

  # Ki·ªÉm tra v√† ch·∫°y script con
  if [[ -x "$script_path" ]]; then
    # Ki·ªÉm tra xem c√≥ tham s·ªë th·ª© hai kh√¥ng ƒë·ªÉ g·ªçi script cho ƒë√∫ng
    if [[ -n "$arg2" ]]; then
      "$script_path" "$arg1" "$arg2" # G·ªçi v·ªõi 2 tham s·ªë theo th·ª© t·ª± ƒë√£ ƒë·∫∑t
    elif [[ -n "$arg1" ]]; then
      "$script_path" "$arg1" # G·ªçi v·ªõi 1 tham s·ªë
    else
      "$script_path" # G·ªçi kh√¥ng c√≥ tham s·ªë (d·ª± ph√≤ng, kh√¥ng x·∫£y ra v·ªõi logic hi·ªán t·∫°i)
    fi
  else
    echo "L·ªói: Kh√¥ng t√¨m th·∫•y ho·∫∑c kh√¥ng th·ªÉ th·ª±c thi script '$script_path'."
  fi
  # read -rp "Nh·∫•n Enter ƒë·ªÉ quay l·∫°i menu..." # B·ªè comment n·∫øu mu·ªën t·∫°m d·ª´ng
}

. /etc/wptt/wptt-callback-menu-chon
