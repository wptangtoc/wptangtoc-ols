#!/bin/bash

function huong_dan(){
TÃ­nh nÄƒng kiá»ƒm tra tá»‘c Ä‘á»™ xá»­ lÃ½ PHP báº±ng lá»‡nh strace -c php index.php trong WPTangToc OLS lÃ  má»™t cÃ´ng cá»¥ cháº©n Ä‘oÃ¡n vÃ  phÃ¢n tÃ­ch hiá»‡u suáº¥t cáº¥p tháº¥p, giÃºp báº¡n hiá»ƒu cÃ¡ch má»™t ká»‹ch báº£n PHP [cá»¥ thá»ƒ lÃ  index.php] tÆ°Æ¡ng tÃ¡c vá»›i há»‡ Ä‘iá»u hÃ nh.

Má»¥c Ä‘Ã­ch vÃ  lá»£i Ã­ch cá»§a tÃ­nh nÄƒng nÃ y:
 * XÃ¡c Ä‘á»‹nh nÃºt cá»• chai [Bottlenecks] cáº¥p há»‡ thá»‘ng: NÃ³ khÃ´ng Ä‘o tá»‘c Ä‘á»™ thá»±c thi mÃ£ PHP má»™t cÃ¡ch trá»±c tiáº¿p nhÆ° cÃ¡c cÃ´ng cá»¥ profiling [Xdebug, Blackfire]. Thay vÃ o Ä‘Ã³, nÃ³ cho báº¡n biáº¿t PHP script Ä‘ang dÃ nh bao nhiÃªu thá»i gian Ä‘á»ƒ chá» Ä‘á»£i hoáº·c tÆ°Æ¡ng tÃ¡c vá»›i há»‡ Ä‘iá»u hÃ nh.
 * PhÃ¢n tÃ­ch I/O: Báº¡n cÃ³ thá»ƒ tháº¥y rÃµ script Ä‘ang tá»‘n nhiá»u thá»i gian cho viá»‡c Ä‘á»c [read], ghi [write], má»Ÿ [openat], hay kiá»ƒm tra [stat] tá»‡p tin hay khÃ´ng. ÄÃ¢y lÃ  dáº¥u hiá»‡u cá»§a cÃ¡c váº¥n Ä‘á» liÃªn quan Ä‘áº¿n á»• cá»©ng cháº­m hoáº·c mÃ£ nguá»“n truy cáº­p file khÃ´ng hiá»‡u quáº£. ðŸ’¾
 * Kiá»ƒm tra tÆ°Æ¡ng tÃ¡c máº¡ng: Náº¿u script cÃ³ káº¿t ná»‘i máº¡ng, báº¡n sáº½ tháº¥y thá»i gian dÃ nh cho cÃ¡c lá»i gá»i nhÆ° socket, connect, sendto, recvfrom.
 * Cháº©n Ä‘oÃ¡n sá»± cá»‘: GiÃºp phÃ¡t hiá»‡n cÃ¡c váº¥n Ä‘á» liÃªn quan Ä‘áº¿n quyá»n truy cáº­p tá»‡p, káº¿t ná»‘i khÃ´ng thÃ nh cÃ´ng, hoáº·c cÃ¡c lá»—i khÃ¡c á»Ÿ táº§ng há»‡ Ä‘iá»u hÃ nh.

TÃ³m láº¡i, Ä‘Ã¢y má»™t cÃ´ng cá»¥ cháº©n Ä‘oÃ¡n nÃ¢ng cao, cung cáº¥p cÃ¡i nhÃ¬n sÃ¢u sáº¯c vá» sá»± tÆ°Æ¡ng tÃ¡c giá»¯a PHP vÃ  há»‡ Ä‘iá»u hÃ nh, giÃºp tÃ¬m ra cÃ¡c nguyÃªn nhÃ¢n gÃ¢y cháº­m trá»… khÃ´ng náº±m trá»±c tiáº¿p trong logic mÃ£ PHP.
}


. /etc/wptt/.wptt.conf
if [[ $ngon_ngu = '' ]];then
	ngon_ngu='vi'
fi
. /etc/wptt/lang/$ngon_ngu.sh

echo ""
echo ""
echo ""
echo "========================================================================="
echo "|$quan_ly_logs => $xem_kiem_tra_toc_do_su_ly_php_he_thong                |"
echo "========================================================================="
. /etc/wptt/tenmien
echo ""
echo ""
echo "$lua_chon_website_ban_muon kiá»ƒm tra: "
echo ""
lua_chon_NAME

pathcheck="/etc/wptt/vhost/.$NAME.conf"
if [[ ! -f "$pathcheck" || "$NAME" = "0" ]]; then
    clear
. /etc/wptt/wptt-logs-main
    exit
fi


checktool="/usr/bin/strace"
if [[ ! -f $checktool ]]; then
	yum install strace -y
fi

echo "Thoi gian su ly PHP website $NAME : "

strace -c php /usr/local/lsws/$NAME/html/index.php

check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]];then
. /etc/wptt/wptt-logs-main 1
fi


