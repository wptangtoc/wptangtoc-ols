#!/bin/bash


function huong_dan(){
TÃ­nh nÄƒng Há»§y thiáº¿t láº­p cháº·n háº¿t quá»‘c gia CSF trong WPTangToc OLS cÃ³ má»¥c Ä‘Ã­ch lÃ  gá»¡ bá» toÃ n bá»™ cÃ¡c cáº¥u hÃ¬nh cháº·n truy cáº­p dá»±a trÃªn quá»‘c gia Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p trÆ°á»›c Ä‘Ã³ trong tÆ°á»ng lá»­a ConfigServer Security & Firewall [CSF]. Sau khi thá»±c hiá»‡n, CSF sáº½ khÃ´ng cÃ²n Ã¡p dá»¥ng báº¥t ká»³ quy táº¯c nÃ o Ä‘á»ƒ cháº·n hoáº·c chá»‰ cho phÃ©p truy cáº­p tá»« cÃ¡c quá»‘c gia cá»¥ thá»ƒ ná»¯a.

ðŸŽ¯ Má»¥c Ä‘Ã­ch cá»§a viá»‡c há»§y bá» hoÃ n toÃ n viá»‡c cháº·n theo quá»‘c gia
 * Má»Ÿ hoÃ n toÃ n truy cáº­p Ä‘á»‹a lÃ½: Cho phÃ©p táº¥t cáº£ cÃ¡c quá»‘c gia truy cáº­p vÃ o mÃ¡y chá»§ cá»§a báº¡n, gá»¡ bá» má»i rÃ o cáº£n dá»±a trÃªn vá»‹ trÃ­ Ä‘á»‹a lÃ½ Ä‘Ã£ cÃ i Ä‘áº·t trÆ°á»›c Ä‘Ã³ [dÃ¹ lÃ  cháº·n má»™t sá»‘ nÆ°á»›c hay chá»‰ cho phÃ©p má»™t sá»‘ nÆ°á»›c].
 * ÄÆ¡n giáº£n hÃ³a tá»‘i Ä‘a cáº¥u hÃ¬nh: Náº¿u báº¡n khÃ´ng cÃ²n muá»‘n sá»­ dá»¥ng cÆ¡ cháº¿ lá»c theo quá»‘c gia vÃ  muá»‘n tÆ°á»ng lá»­a hoáº¡t Ä‘á»™ng mÃ  khÃ´ng cÃ³ sá»± phÃ¢n biá»‡t nÃ y.
 * Kháº¯c phá»¥c sá»± cá»‘ phá»©c táº¡p: Khi nghi ngá» cÃ¡c quy táº¯c cháº·n quá»‘c gia [báº¥t ká»ƒ lÃ  CC_DENY hay CC_ALLOW] Ä‘ang gÃ¢y ra cÃ¡c váº¥n Ä‘á» truy cáº­p khÃ´ng mong muá»‘n vÃ  khÃ³ xÃ¡c Ä‘á»‹nh.
 * Chuáº©n bá»‹ cho chiáº¿n lÆ°á»£c má»›i: XÃ³a sáº¡ch cÃ¡c cÃ i Ä‘áº·t cÅ© Ä‘á»ƒ thiáº¿t láº­p má»™t chiáº¿n lÆ°á»£c kiá»ƒm soÃ¡t truy cáº­p hoÃ n toÃ n má»›i khÃ´ng dá»±a trÃªn quá»‘c gia

TÃ³m láº¡i, tÃ­nh nÄƒng Há»§y thiáº¿t láº­p cháº·n háº¿t quá»‘c gia CSF trong WPTangToc OLS giÃºp báº¡n nhanh chÃ³ng Ä‘Æ°a CSF vá» tráº¡ng thÃ¡i khÃ´ng thá»±c hiá»‡n báº¥t ká»³ viá»‡c lá»c truy cáº­p nÃ o dá»±a trÃªn quá»‘c gia, cho phÃ©p má»i káº¿t ná»‘i Ä‘á»‹a lÃ½ [trá»« khi bá»‹ cháº·n bá»Ÿi cÃ¡c quy táº¯c khÃ¡c cá»§a CSF].
}


echo "========================================================================="
echo "|Quáº£n lÃ½ báº£o máº­t => CSF => Há»§y bá» Cháº·n Quá»‘c gia                         |"
echo "========================================================================="

. /etc/wptt/echo-color
if [ ! -f /etc/csf/csf.conf ]; then
	echoDo "Báº¡n chÆ°a cÃ i Ä‘áº·t CSF"
	. /etc/wptt/bao-mat/csf-main 1
fi

countryblicklist=`grep "CC_DENY =\ " /etc/csf/csf.conf | awk 'NR==1 {print $3}' | cut -d \" -f 2`
if [ "$countryblicklist" = "" ]; then
echo "========================================================================="
echo "Hiá»‡n táº¡i CSF Firewall cháº·n quá»‘c gia chÆ°a Ä‘Æ°á»£c thiáº¿t láº­p. "
echo "-------------------------------------------------------------------------"
. /etc/wptt/bao-mat/csf-main 1
fi
_runing "Táº¯t tÃ­nh nÄƒng cháº·n toÃ n bá»™ quá»‘c gia chá»‰ cho phÃ©p má»™t sá»‘ quá»‘c gia Ä‘Æ°á»£c truy cáº­p"
sed -i "s/.*CC_DENY\ =.*/CC_DENY = \"\"/g" /etc/csf/csf.conf
csf -x >/dev/null 2>&1
csf -e >/dev/null 2>&1
systemctl restart csf
systemctl restart lfd

echo "Huá»· cháº·n theo quá»‘c gia CSF: $(date '+%d-%m-%Y %H:%M')" >> /var/log/wptangtoc-ols.log

_rundone "Táº¯t tÃ­nh nÄƒng cháº·n toÃ n bá»™ quá»‘c gia chá»‰ cho phÃ©p má»™t sá»‘ quá»‘c gia Ä‘Æ°á»£c truy cáº­p"

check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]];then
. /etc/wptt/bao-mat/csf-main 1
fi

