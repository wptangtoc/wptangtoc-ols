#!/bin/bash

function huong_dan() {
  WPTangToc OLS cÃ³ tÃ­nh nÄƒng táº¯t XML-RPC WordPress, thÃ¬ Ä‘Ã¢y lÃ  má»™t biá»‡n phÃ¡p báº£o máº­t vÃ  tá»‘i Æ°u hÃ³a quan trá»ng, giÃºp báº¡n vÃ´ hiá»‡u hÃ³a tá»‡p xmlrpc.php trÃªn cÃ¡c website WordPress cá»§a mÃ¬nh.

  XML-RPC lÃ  gÃ¬?
  * xmlrpc.php lÃ  má»™t tá»‡p tin trong WordPress, hoáº¡t Ä‘á»™ng nhÆ° má»™t Giao diá»‡n Láº­p trÃ¬nh á»¨ng dá»¥ng [API]. NÃ³ cho phÃ©p cÃ¡c á»©ng dá»¥ng vÃ  dá»‹ch vá»¥ bÃªn ngoÃ i káº¿t ná»‘i vÃ  thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng trÃªn website WordPress cá»§a báº¡n tá»« xa [vÃ­ dá»¥: Ä‘Äƒng bÃ i tá»« Ä‘iá»‡n thoáº¡i, nháº­n thÃ´ng bÃ¡o pingback/trackback, káº¿t ná»‘i vá»›i cÃ¡c dá»‹ch vá»¥ nhÆ° Jetpack].

  ðŸŽ¯ Táº¡i sao cáº§n táº¯t XML-RPC?
  * TÄƒng cÆ°á»ng Báº£o máº­t: ÄÃ¢y lÃ  lÃ½ do chÃ­nh. xmlrpc.php lÃ  má»™t má»¥c tiÃªu táº¥n cÃ´ng ráº¥t phá»• biáº¿n:
  * Táº¥n cÃ´ng Brute-Force: Káº» táº¥n cÃ´ng cÃ³ thá»ƒ thá»­ hÃ ng ngÃ n máº­t kháº©u qua xmlrpc.php Ä‘á»ƒ dÃ² tÃ i khoáº£n admin.
  * Táº¥n cÃ´ng DDoS [Khuáº¿ch Ä‘áº¡i]: Lá»£i dá»¥ng tÃ­nh nÄƒng pingback Ä‘á»ƒ táº¥n cÃ´ng cÃ¡c website khÃ¡c.
  * QuÃ©t vÃ  Thu tháº­p ThÃ´ng tin: Bá»‹ lá»£i dá»¥ng Ä‘á»ƒ tÃ¬m kiáº¿m ngÆ°á»i dÃ¹ng hoáº·c thÃ´ng tin khÃ¡c.
  * Giáº£m táº£i Server: VÃ´ hiá»‡u hÃ³a xmlrpc.php giÃºp ngÄƒn cháº·n cÃ¡c truy cáº­p khÃ´ng mong muá»‘n tá»« bot vÃ  káº» táº¥n cÃ´ng, giáº£m bá»›t gÃ¡nh náº·ng khÃ´ng cáº§n thiáº¿t cho mÃ¡y chá»§.
  * KhÃ´ng cÃ²n Cáº§n thiáº¿t: Vá»›i sá»± phÃ¡t triá»ƒn cá»§a REST API trong WordPress, nhiá»u chá»©c nÄƒng cá»§a XML-RPC Ä‘Ã£ trá»Ÿ nÃªn lá»—i thá»i hoáº·c Ã­t Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»‘i vá»›i nhiá»u website hiá»‡n Ä‘áº¡i.

  TÃ³m láº¡i: TÃ­nh nÄƒng táº¯t xmlrpc.php trong WPTangToc OLS lÃ  má»™t cÃ´ng cá»¥ há»¯u Ã­ch giÃºp báº¡n gia cá»‘ báº£o máº­t vÃ  giáº£m táº£i cho website WordPress báº±ng cÃ¡ch loáº¡i bá» má»™t cá»•ng giao tiáº¿p thÆ°á»ng bá»‹ lá»£i dá»¥ng Ä‘á»ƒ táº¥n cÃ´ng. ÄÃ¢y lÃ  má»™t trong nhá»¯ng bÆ°á»›c báº£o máº­t cÆ¡ báº£n Ä‘Æ°á»£c khuyáº¿n nghá»‹ cho háº§u háº¿t cÃ¡c website WordPress hiá»‡n nay, miá»…n lÃ  báº¡n khÃ´ng cÃ²n phá»¥ thuá»™c vÃ o cÃ¡c chá»©c nÄƒng cá»§a XML-RPC.
}

echo ""
echo ""
echo ""
echo "========================================================================="
echo "|Quáº£n lÃ½ WordPress => Táº¯t xml-rpc WordPress                              |"
echo "========================================================================="
. /etc/wptt/tenmien
echo ""
echo ""
echo "Lá»±a chá»n website báº¡n muá»‘n táº¯t xml-rpc WordPress: "
echo ""
lua_chon_NAME

. /etc/wptt/echo-color
if [[ "$NAME" = "0" || "$NAME" = "" ]]; then
  . /etc/wptt/wptt-wordpress-main 1
fi

pathcheck="/etc/wptt/vhost/.$NAME.conf"
if [[ ! -f "$pathcheck" ]]; then
  clear
  echoDo "TÃªn miá»n khÃ´ng tá»“n táº¡i trÃªn há»‡ thá»‘ng nÃ y"
  sleep 3
  . /etc/wptt/wptt-wordpress-main 1
  exit
fi

pathcheckwp="/usr/local/lsws/$NAME/html/wp-load.php"
if [[ ! -f "$pathcheckwp" ]]; then
  clear
  echoDo "Há»‡ thá»‘ng xÃ¡c nháº­n báº¡n khÃ´ng sá»­ dá»¥ng WordPress"
  echoDo "TÃ­nh nÄƒng nÃ y chá»‰cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng trÃªn WordPress"
  sleep 3
  . /etc/wptt/wptt-wordpress-main 1
  exit
fi

. /etc/wptt/vhost/."$NAME".conf

pathcheckplugin="/usr/local/lsws/$NAME/html/wp-content/plugins/xml-rpc-wptangtoc"
if [[ -d "$pathcheckplugin" ]]; then
  echoDo "ban da kich hoat tat xml-rpc wordpress roi"
  . /etc/wptt/wptt-wordpress-main 1
fi

read -p "Báº¡n muá»‘n táº¯t xml rpc wordpress (y/n): " check
if [[ "$check" = "y" ]]; then
  . /etc/wptt/php/php-cli-domain-config $NAME

  _runing "Táº¯t xml rpc WordPress cho website $NAME"
  /usr/local/lsws/lsphp${phien_ban_php_domain_thuc_thi}/bin/php /usr/local/bin/wp plugin install https://wptangtoc.com/share/xml-rpc-wptangtoc.zip --path=/usr/local/lsws/"$NAME"/html --activate --allow-root >/dev/null 2>&1
  chown -R "$User_name_vhost":"$User_name_vhost" /usr/local/lsws/"$NAME"/html/wp-content/plugins/xml-rpc-wptangtoc
  cd /usr/local/lsws/"$NAME"/html/wp-content/plugins/xml-rpc-wptangtoc && find . -type d -exec chmod 755 {} \;
  cd /usr/local/lsws/"$NAME"/html/wp-content/plugins/xml-rpc-wptangtoc && find . -type f -exec chmod 644 {} \;
  _rundone "Táº¯t xml rpc WordPress cho website $NAME"
fi
check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]]; then
  . /etc/wptt/wptt-wordpress-main 1
fi
