#!/bin/bash
# @author: Gia Tuấn
# @website: https://wptangtoc.com
# @email: giatuan@wptangtoc.com
# @since: 2025

function huong_dan() {
  Xem tổng quan: Giúp bạn nhanh chóng biết được có bao nhiêu database đang tồn tại trên server.

  Hỗ trợ quản lý: Là bước đầu tiên cho các tác vụ quản lý khác như sao lưu, tối ưu, hoặc kiểm tra dung lượng [tuy nhiên, các tác vụ này có thể là các tính năng riêng biệt].

}

echo ""
echo ""
echo ""
echo "========================================================================="
echo "|Quản lý Database => Xem thông tin database                             |"
echo "========================================================================="
echo ""
echo ""
. /etc/wptt/.wptt.conf

echo "Danh sách các Database"

TEMP_CNF_ROOT=$(mktemp)
chmod 600 "$TEMP_CNF_ROOT" # Chỉ root mới đọc được
cat >"$TEMP_CNF_ROOT" <<EOF
[client]
user=${database_admin_username}
password=${database_admin_password}
host=localhost
max_allowed_packet=1G
default-character-set=utf8mb4

[mysqldump]
quick
quote-names
max_allowed_packet=1G
EOF

mariadb --defaults-extra-file="$TEMP_CNF_ROOT" -e "show databases where \`database\` not in('information_schema', 'test', 'sys', 'mysql', 'performance_schema')"
rm -rf $TEMP_CNF_ROOT
echo ""

check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]]; then
  exec /etc/wptt/wptt-db-main 1
fi
