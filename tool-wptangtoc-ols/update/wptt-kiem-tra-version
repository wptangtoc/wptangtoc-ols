#!/bin/bash

function huong_dan() {
  T√≠nh nƒÉng ki·ªÉm tra phi√™n b·∫£n nh·ªØng service quan tr·ªçng, th√¨ ƒë√¢y l√† m·ªôt ch·ª©c nƒÉng ch·∫©n ƒëo√°n v√† th√¥ng tin r·∫•t h·ªØu √≠ch, gi√∫p b·∫°n nhanh ch√≥ng xem ƒë∆∞·ª£c c√°c phi√™n b·∫£n c·ª• th·ªÉ c·ªßa c√°c ph·∫ßn m·ªÅm/d·ªãch v·ª• c·ªët l√µi ƒëang ch·∫°y tr√™n m√°y ch·ªß c·ªßa b·∫°n.

  T√≠nh nƒÉng Ki·ªÉm tra Phi√™n b·∫£n Service
  üíª M·ª•c ƒë√≠ch ch√≠nh:
  Vi·ªác bi·∫øt ch√≠nh x√°c phi√™n b·∫£n c·ªßa c√°c d·ªãch v·ª• l√† r·∫•t c·∫ßn thi·∫øt cho nhi·ªÅu m·ª•c ƒë√≠ch:
  * Kh·∫Øc ph·ª•c s·ª± c·ªë [Troubleshooting]: Khi website g·∫∑p l·ªói, bi·∫øt phi√™n b·∫£n gi√∫p x√°c ƒë·ªãnh xem c√≥ ph·∫£i do xung ƒë·ªôt ho·∫∑c l·ªói ƒë√£ bi·∫øt c·ªßa m·ªôt ph·∫ßn m·ªÅm c·ª• th·ªÉ hay kh√¥ng.
  * Ki·ªÉm tra T∆∞∆°ng th√≠ch: ƒê·∫£m b·∫£o r·∫±ng phi√™n b·∫£n m√°y ch·ªß [PHP, MariaDB] ƒë√°p ·ª©ng y√™u c·∫ßu c·ªßa phi√™n b·∫£n WordPress, theme, v√† plugin m√† b·∫°n ƒëang s·ª≠ d·ª•ng ho·∫∑c ƒë·ªãnh c√†i ƒë·∫∑t.
  * ƒê√°nh gi√° B·∫£o m·∫≠t: Ph√°t hi·ªán c√°c d·ªãch v·ª• ƒëang ch·∫°y phi√™n b·∫£n c≈©, c√≥ th·ªÉ ch·ª©a l·ªó h·ªïng b·∫£o m·∫≠t ch∆∞a ƒë∆∞·ª£c v√°.
  * L·∫≠p k·∫ø ho·∫°ch C·∫≠p nh·∫≠t: Gi√∫p b·∫°n bi·∫øt d·ªãch v·ª• n√†o c·∫ßn ƒë∆∞·ª£c n√¢ng c·∫•p l√™n phi√™n b·∫£n m·ªõi h∆°n.
  * Cung c·∫•p Th√¥ng tin H·ªó tr·ª£: Khi b·∫°n c·∫ßn nh·ªù h·ªó tr·ª£ k·ªπ thu·∫≠t, vi·ªác cung c·∫•p ch√≠nh x√°c c√°c phi√™n b·∫£n ƒëang d√πng l√† th√¥ng tin c∆° b·∫£n v√† quan tr·ªçng.

  ‚úÖ L·ª£i √≠ch khi c√≥ t√≠nh nƒÉng n√†y trong WPTangToc OLS:
  * Ti·ªán l·ª£i: Ch·ªâ c·∫ßn m·ªôt l·ªánh ho·∫∑c m·ªôt t√πy ch·ªçn menu ƒë·ªÉ xem t·∫•t c·∫£ th√¥ng tin quan tr·ªçng, thay v√¨ ph·∫£i g√µ nhi·ªÅu l·ªánh kh√°c nhau.
  * Nhanh ch√≥ng: Cung c·∫•p m·ªôt c√°i nh√¨n t·ªïng quan t·ª©c th√¨ v·ªÅ s·ª©c kh·ªèe v√† c·∫•u h√¨nh ph·∫ßn m·ªÅm c·ªßa m√°y ch·ªß.
  * D·ªÖ d√†ng: Gi√∫p ng∆∞·ªùi d√πng kh√¥ng r√†nh v·ªÅ d√≤ng l·ªánh c≈©ng c√≥ th·ªÉ xem ƒë∆∞·ª£c th√¥ng tin c·∫ßn thi·∫øt.

  T√≥m l·∫°i: T√≠nh nƒÉng ki·ªÉm tra phi√™n b·∫£n d·ªãch v·ª• trong WPTangToc OLS l√† m·ªôt c√¥ng c·ª• ch·∫©n ƒëo√°n v√† cung c·∫•p th√¥ng tin h·ªØu √≠ch, gi√∫p b·∫°n n·∫Øm r√µ c·∫•u h√¨nh ph·∫ßn m·ªÅm tr√™n m√°y ch·ªß, h·ªó tr·ª£ ƒë·∫Øc l·ª±c cho vi·ªác kh·∫Øc ph·ª•c s·ª± c·ªë, l√™n k·∫ø ho·∫°ch c·∫≠p nh·∫≠t v√† ƒë·∫£m b·∫£o an ninh, t∆∞∆°ng th√≠ch cho website WordPress c·ªßa b·∫°n.
}

echo ""
echo ""
echo ""
check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "99" ]]; then
  echo "========================================================================="
  echo "|Qu·∫£n l√Ω Update => Ki·ªÉm tra phi√™n b·∫£n ph·∫ßn m·ªÅm                          |"
  echo "========================================================================="
else
  echo "========================================================================="
  echo "|Qu·∫£n l√Ω serivce => Ki·ªÉm tra phi√™n b·∫£n ph·∫ßn m·ªÅm                          |"
  echo "========================================================================="
fi

echo ""
echo ""

. /etc/wptt/.wptt.conf
openlitespeed_check_version=$(/usr/local/lsws/bin/lshttpd -v | grep LiteSpeed | cut -f1 -d ' ' | cut -f2 -d '/')
php_version=$(php -v | grep cli | cut -f 2 -d " ")
database=$(mariadb --version | grep -oP '[0-9]+\.[0-9]+\.[0-9]+-MariaDB' | cut -d'-' -f1)
fail2ban=$(fail2ban-client --version | cut -f2 -d "v")
hedieuhanh=$(hostnamectl | grep System | cut -f2 -d':')
curl=$(curl --version | grep curl | cut -f 2 -d " ")
wp_cli=$(wp --info | grep 'WP-CLI version' | cut -f2)
kern=$(uname -r | cut -f 1 -d "-")
tuong_lua=$(firewall-cmd --version)

if $(cat /etc/*release | grep -q "Ubuntu\|AlmaLinux 9"); then
  duong_dan_config_redis="/etc/redis/redis.conf"
else
  duong_dan_config_redis="/etc/redis.conf"
fi

if [[ -f $duong_dan_config_redis ]]; then
  redis=$(redis-server --version | cut -f3 -d ' ' | sed 's/v=//g')
fi
echo "+-----------------------------------------------------------------------+"
echo "|Ki·ªÉm tra phi√™n b·∫£n hi·ªán t·∫°i c·ªßa b·∫°n					|"
echo "+-----------------------------------------------------------------------+"
echo "|WPTangToc OLS            : $version_wptangtoc_ols					|"
echo "|LiteSpeed                : $openlitespeed_check_version					|"
echo "|MariaDB                  : $database					|"
echo "|PHP CLI                  : $php_version					|"
echo "|He dieu hanh             :$hedieuhanh			|"
echo "|Fail2Ban                 : $fail2ban					|"
echo "|Kernel linux core        : $kern					|"
echo "|WP CLI                   : $wp_cli					|"
echo "|Curl                     : $curl					|"
echo "|Firewall                 : $tuong_lua					|"

if [[ -f $duong_dan_config_redis ]]; then
  echo "|Redis 					: $redis					|"
fi

echo "+-----------------------------------------------------------------------+"

check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]]; then
  . /etc/wptt/wptt-service-main 1
fi
if [[ $check_menu_wptangtoc_active = "99" ]]; then
  . /etc/wptt/wptt-update-main 1
fi
