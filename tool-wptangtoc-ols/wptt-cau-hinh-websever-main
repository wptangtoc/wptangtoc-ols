#!/bin/bash
# @author: Gia Tu·∫•n
# @website: https://wptangtoc.com
# @email: giatuan@wptangtoc.com
# @since: 2025


function huong_dan(){
T√≠nh nƒÉng C·∫•u h√¨nh Webserver trong WPTangToc OLS l√† m·ªôt b·ªô c√¥ng c·ª• v√† t√πy ch·ªçn gi√∫p b·∫°n ƒëi·ªÅu ch·ªânh c√°c thi·∫øt l·∫≠p c·ªët l√µi c·ªßa m√°y ch·ªß web m·ªôt c√°ch thu·∫≠n ti·ªán ngay t·ª´ giao di·ªán d√≤ng l·ªánh c·ªßa script. ‚öôÔ∏èüåê

Gi·ªõi thi·ªáu ng·∫Øn g·ªçn:
M·ª•c ƒë√≠ch: ƒê∆°n gi·∫£n h√≥a vi·ªác t√πy ch·ªânh c√°c kh√≠a c·∫°nh quan tr·ªçng c·ªßa OpenLiteSpeed, cho ph√©p ng∆∞·ªùi d√πng tinh ch·ªânh hi·ªáu su·∫•t, b·∫£o m·∫≠t, v√† h√†nh vi c·ªßa m√°y ch·ªß web m√† kh√¥ng c·∫ßn ph·∫£i can thi·ªáp s√¢u v√†o c√°c file c·∫•u h√¨nh ph·ª©c t·∫°p ho·∫∑c ho√†n to√†n d·ª±a v√†o WebAdmin GUI c·ªßa OLS.
C√°ch ho·∫°t ƒë·ªông [th∆∞·ªùng th·∫•y c√≥ th·ªÉ bao g·ªìm]:
 * Qu·∫£n l√Ω Virtual Host [vHost]: H·ªó tr·ª£ t·∫°o, s·ª≠a, x√≥a c·∫•u h√¨nh cho t·ª´ng website [domain], bao g·ªìm thi·∫øt l·∫≠p th∆∞ m·ª•c g·ªëc, li√™n k·∫øt t√™n mi·ªÅn [ƒë√£ ƒë∆∞·ª£c ƒë·ªÅ c·∫≠p trong qu·∫£n l√Ω domain].
 * C·∫•u h√¨nh Listener: ƒêi·ªÅu ch·ªânh c∆° b·∫£n c√°c c·ªïng l·∫Øng nghe [v√≠ d·ª•: port 80, 443] v√† c√°ch OLS x·ª≠ l√Ω k·∫øt n·ªëi ƒë·∫øn.
 * T·ªëi ∆∞u h√≥a c∆° b·∫£n: Cung c·∫•p t√πy ch·ªçn ƒë·ªÉ √°p d·ª•ng c√°c thi·∫øt l·∫≠p t·ªëi ∆∞u h√≥a hi·ªáu su·∫•t ph·ªï bi·∫øn cho OLS.
 * Rewrite Rules: C√≥ th·ªÉ cung c·∫•p giao di·ªán ƒë·ªÉ qu·∫£n l√Ω ho·∫∑c th√™m c√°c quy t·∫Øc vi·∫øt l·∫°i URL [rewrite rules] cho t·ª´ng vHost ho·∫∑c to√†n c·ª•c.
 * C·∫•u h√¨nh PHP Handler: Li√™n k·∫øt c√°c phi√™n b·∫£n PHP v·ªõi c√°c website c·ª• th·ªÉ [ƒë√£ ƒë·ªÅ c·∫≠p trong qu·∫£n l√Ω PHP].
 * Thi·∫øt l·∫≠p b·∫£o m·∫≠t c∆° b·∫£n: √Åp d·ª•ng m·ªôt s·ªë ti√™u ƒë·ªÅ b·∫£o m·∫≠t [security headers] ho·∫∑c c√°c c·∫•u h√¨nh b·∫£o m·∫≠t ·ªü c·∫•p ƒë·ªô m√°y ch·ªß.
 * Truy c·∫≠p file c·∫•u h√¨nh OLS: C√≥ th·ªÉ cung c·∫•p l·ªëi t·∫Øt ƒë·ªÉ ch·ªânh s·ª≠a tr·ª±c ti·∫øp c√°c file c·∫•u h√¨nh quan tr·ªçng c·ªßa OLS [v·ªõi c·∫£nh b√°o].
L·ª£i √≠ch:
 * Ki·ªÉm so√°t linh ho·∫°t: Cho ph√©p t√πy ch·ªânh m√°y ch·ªß web theo nhu c·∫ßu c·ª• th·ªÉ.
 * ƒê∆°n gi·∫£n h√≥a: Gi·∫£m ƒë·ªô ph·ª©c t·∫°p so v·ªõi vi·ªác ch·ªânh s·ª≠a th·ªß c√¥ng file c·∫•u h√¨nh g·ªëc c·ªßa OpenLiteSpeed.
 * Ti·ªán l·ª£i: Th·ª±c hi·ªán c√°c thay ƒë·ªïi nhanh ch√≥ng ngay t·ª´ WPTangToc OLS.
 * T·ªëi ∆∞u h√≥a: Gi√∫p ng∆∞·ªùi d√πng √°p d·ª•ng c√°c c·∫•u h√¨nh t·ªët nh·∫•t cho hi·ªáu su·∫•t v√† b·∫£o m·∫≠t.
T√≠nh nƒÉng n√†y l√† trung t√¢m c·ªßa vi·ªác qu·∫£n tr·ªã m√°y ch·ªß web, gi√∫p b·∫°n ƒë·ªãnh h√¨nh c√°ch OpenLiteSpeed ho·∫°t ƒë·ªông v√† ph·ª•c v·ª• c√°c website c·ªßa m√¨nh m·ªôt c√°ch hi·ªáu qu·∫£.
}


if [[ $1 = "" ]];then
. /etc/wptt/wptt-header-menu
header_menu
echo ""
echo ""
echo "$ghi_chu_muc_nay_chi_danh_cho_nguoi_nang_cao"
echo "$hay_het_suc_can_than_trong_qua_trinh_chinh_sua"
else
	. /etc/wptt/echo-color
echoDo "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-="
fi

. /etc/wptt/.wptt.conf
if [[ $ngon_ngu = '' ]];then
	ngon_ngu='vi'
fi
. /etc/wptt/lang/$ngon_ngu.sh

echo ""
echo ""
echo "$cau_hinh_webserver:"
echo ""
options=(
    "$chinh_sua LiteSpeed"                                   #1
    "$chinh_sua Vhost"                                       #2
    "$chinh_sua Maria Database"                              #3
    "$chinh_sua .htaccess"                                   #4
    "$chinh_sua PHP.ini"                                     #5
    "$chinh_sua Cron JOB"                                    #6
    "$chinh_sua Redis"                                    #8
    "$chinh_sua Fail2ban"                                    #9
    "$chinh_sua Hotname"                                    #9
	"$thay_doi $cong_cu_cau_hinh" #10
)
# H√†m th·ª±c thi h√†nh ƒë·ªông d·ª±a tr√™n index (cho menu C·∫•u h√¨nh Webserver)
run_action() {
    local index=$1
    local script_path=""
    local script_args="" # Tham s·ªë s·∫Ω ƒë∆∞·ª£c ƒë·∫∑t trong case

    case $index in
         0) script_path="/etc/wptt/cau-hinh/wptt-sua-websever";          script_args="98" ;; # LiteSpeed
         1) script_path="/etc/wptt/cau-hinh/wptt-cau-hinh-vhost";         script_args="98" ;; # Vhost
         2) script_path="/etc/wptt/cau-hinh/wptt-sua-mariadb";           script_args="98" ;; # MariaDB
         3) script_path="/etc/wptt/cau-hinh/wptt-cau-hinh-htaccess";      script_args="98" ;; # .htaccess
         4) script_path="/etc/wptt/php/wptt-sua-phpini";                script_args="99" ;; # PHP.ini (Ch√∫ √Ω: th∆∞ m·ª•c php v√† tham s·ªë 99)
         5) script_path="/etc/wptt/cau-hinh/wptt-cron";                 script_args="98" ;; # Cron JOB
         6) script_path="/etc/wptt/cau-hinh/wptt-cau-hinh-redis";         script_args="98" ;; # Redis
         7) script_path="/etc/wptt/cau-hinh/wptt-cau-hinh-fail2ban";     script_args="98" ;; # Fail2ban
         8) script_path="/etc/wptt/cau-hinh/wptt-hostname";      script_args="98" ;; # Editor
         9) script_path="/etc/wptt/cau-hinh/wptt-editor-cau-hinh";      script_args="98" ;; # Editor
        *) echo "${lua_chon_khong_hop_le:-L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá}: Index $index."; return 1 ;;
    esac

    # Ki·ªÉm tra v√† ch·∫°y script con
    if [[ -x "$script_path" ]]; then
        # Ki·ªÉm tra xem script_args c√≥ ƒë∆∞·ª£c ƒë·∫∑t kh√¥ng (ƒë·ªÅ ph√≤ng l·ªói logic)
        if [[ -n "$script_args" ]]; then
            "$script_path" "$script_args"
        else
            # Tr∆∞·ªùng h·ª£p n√†y kh√¥ng n√™n x·∫£y ra v·ªõi logic hi·ªán t·∫°i, nh∆∞ng v·∫´n c√≥ th·ªÉ g·ªçi kh√¥ng tham s·ªë n·∫øu c·∫ßn
             "$script_path"
             # echo "L·ªói logic: Kh√¥ng t√¨m th·∫•y tham s·ªë cho index $index."
        fi
    else
        echo "L·ªói: Kh√¥ng t√¨m th·∫•y ho·∫∑c kh√¥ng th·ªÉ th·ª±c thi script '$script_path'."
    fi
    # read -rp "Nh·∫•n Enter ƒë·ªÉ quay l·∫°i menu..." # B·ªè comment n·∫øu mu·ªën t·∫°m d·ª´ng
}
. /etc/wptt/wptt-callback-menu-chon

