#!/bin/bash

function huong_dan() {
  TÃ­nh nÄƒng Cáº¥u hÃ¬nh cron [hay Láº­p lá»‹ch cron] lÃ  viá»‡c thiáº¿t láº­p vÃ  quáº£n lÃ½ cÃ¡c tÃ¡c vá»¥ tá»± Ä‘á»™ng [cron jobs] trÃªn há»‡ Ä‘iá»u hÃ nh Linux [vÃ  cÃ¡c há»‡ thá»‘ng tÆ°Æ¡ng tá»± Unix]. Cron lÃ  má»™t trÃ¬nh ná»n [daemon] cháº¡y ngáº§m, cho phÃ©p báº¡n lÃªn lá»‹ch Ä‘á»ƒ cÃ¡c lá»‡nh hoáº·c ká»‹ch báº£n [script] Ä‘Æ°á»£c thá»±c thi láº·p Ä‘i láº·p láº¡i vÃ o nhá»¯ng thá»i Ä‘iá»ƒm cá»¥ thá»ƒ [phÃºt, giá», ngÃ y, thÃ¡ng, thá»©]. â°âš™ï¸ğŸ“œ

  NÃ³i má»™t cÃ¡ch Ä‘Æ¡n giáº£n, cron giá»‘ng nhÆ° má»™t ngÆ°á»i thÆ° kÃ½ cáº§n máº«n mÃ  báº¡n cÃ³ thá»ƒ dáº·n dÃ² Ä‘á»ƒ tá»± Ä‘á»™ng lÃ m má»™t viá»‡c gÃ¬ Ä‘Ã³ cho báº¡n theo lá»‹ch trÃ¬nh Ä‘Ã£ Ä‘á»‹nh, vÃ­ dá»¥: Ä‘Ãºng 2 giá» sÃ¡ng má»—i ngÃ y, hÃ£y cháº¡y script sao lÆ°u nÃ y.

  Má»¥c ÄÃ­ch ChÃ­nh
  * Tá»± Ä‘á»™ng hÃ³a cÃ¡c tÃ¡c vá»¥ láº·p Ä‘i láº·p láº¡i: ÄÃ¢y lÃ  cÃ´ng dá»¥ng cá»‘t lÃµi.
  * Sao lÆ°u [Backup]: Tá»± Ä‘á»™ng sao lÆ°u database, file website, hoáº·c toÃ n bá»™ há»‡ thá»‘ng.
  * Báº£o trÃ¬ há»‡ thá»‘ng: Cháº¡y cÃ¡c script dá»n dáº¹p log cÅ©, file táº¡m, cáº­p nháº­t há»‡ thá»‘ng, kiá»ƒm tra sá»©c khá»e server.
  * Táº¡o bÃ¡o cÃ¡o: Tá»± Ä‘á»™ng táº¡o vÃ  gá»­i bÃ¡o cÃ¡o Ä‘á»‹nh ká»³.
  * Äá»“ng bá»™ hÃ³a dá»¯ liá»‡u: Tá»± Ä‘á»™ng Ä‘á»“ng bá»™ file giá»¯a cÃ¡c server.
  * Gá»­i email thÃ´ng bÃ¡o, nháº¯c nhá»Ÿ.
  * Thá»±c thi cÃ¡c tÃ¡c vá»¥ cá»§a á»©ng dá»¥ng: Nhiá»u á»©ng dá»¥ng web [nhÆ° WordPress, Magento] cáº§n cron Ä‘á»ƒ cháº¡y cÃ¡c tÃ¡c vá»¥ ná»n [vÃ­ dá»¥: Ä‘Äƒng bÃ i theo lá»‹ch, cáº­p nháº­t chá»‰ má»¥c].

  Sau khi cáº¥u hÃ¬nh, cron sáº½ tá»± Ä‘á»™ng thá»±c thi cÃ¡c lá»‡nh hoáº·c script theo Ä‘Ãºng lá»‹ch trÃ¬nh báº¡n Ä‘Ã£ Ä‘áº·t ra, giÃºp tá»± Ä‘á»™ng hÃ³a nhiá»u cÃ´ng viá»‡c quáº£n trá»‹ vÃ  váº­n hÃ nh há»‡ thá»‘ng.
}

. /etc/wptt/.wptt.conf
if [[ $ngon_ngu = '' ]]; then
  ngon_ngu='vi'
fi
. /etc/wptt/lang/$ngon_ngu.sh

echo ""
echo ""
echo ""
echo "========================================================================="
echo "|$cau_hinh_webserver => $chinh_sua cron job                                |"
echo "========================================================================="
echo "ChÆ°Æ¡ng trÃ¬nh há»— trá»£ táº¡o crontab: https://wptangtoc.com/crontab/"
echo "========================================================================="
echo "$xac_nhan $ban_muon $chinh_sua cron job "
prompt="$nhap_lua_chon_cua_ban [1-2]: "
dongy="n"
options=("$dong_y" "$khong_dong_y")
PS3="$prompt"
select opt in "${options[@]}"; do
  case "$REPLY" in
  1)
    dongy="y"
    break
    ;;

  2)
    dongy="n"
    break
    ;;

  $((${#options[@]} + 1)))
    printf "\n$ban_nhap_sai_he_thong_se_chon_khong_dong_y\n"
    break
    ;;
  *)
    printf "$ban_nhap_sai_he_thong_se_chon_khong_dong_y\n"
    break
    ;;
  esac
done

if [[ "$dongy" = "y" ]]; then
  . /etc/wptt/.wptt.conf
  if [[ $editor_cau_hinh = "" ]]; then
    editor_cau_hinh="nano"
  fi
  echo '                                              
                     ::::                     
                    :-::-:                    
        ..      ..::::::::::..      ..        
       :-:-:..:----::::::::---::..:-:-:       
       .:::::--:..          ..:--:::::.       
        .::::.                  :::::.        
        ::::                     .::::        
       ::::       .-=++++=-.       ::::       
      .-::       =*******##*=       ::-.      
  ..::::-.      +********:.+#=      ::::::..  
  ---:::-.     .***=-**- .=***      .-:::---  
  ..::::-.      +**=.  .=****=      ::::::..  
      .-::      .+*#*==*****=       ::-.      
       ::::       :=+***++-.       ::::       
        ::::                      ::::        
        .::::.                  :::::.        
       .:::::--:.            .:--:::::.       
       :-:-:..::--::::..:::---::..:-:-:       
        ..       ..::::::::..       ..        
                    .::::.                    
                     ::::                     
                                              
'
  echo ""
  echo "$cong_cu_cau_hinh: $editor_cau_hinh $de $chinh_sua"
  if [[ $editor_cau_hinh = "nano" ]]; then
    echo "$chinh_sua $xong $nhap ctrl + o $de $luu_lai && ctrl + x $de $exit_thoat"
    sleep 4
  fi
  echo "Cáº¥u hÃ¬nh crond : $(date '+%d-%m-%Y %H:%M')" >>/var/log/wptangtoc-ols.log
  rm -f /tmp/${USER}-crontab_backup.txt
  if [[ $(systemctl is-active mariadb.service 2>/dev/null) = 'active' ]]; then
    crontab -l >/tmp/${USER}-crontab_backup.txt
  fi
  export VISUAL=$editor_cau_hinh
  crontab -e

  if [[ -f /tmp/crontab_backup.txt ]]; then
    if [[ $(systemctl is-active mariadb.service 2>/dev/null) != 'active' ]]; then
      echo "ÄÃ£ bá»‹ lá»—i rá»“i, há»‡ thá»‘ng tá»± Ä‘á»™ng restore crontab láº¡i trÆ°á»›c khi báº¡n edit Ä‘á»ƒ báº£o Ä‘áº£m hoáº¡t Ä‘á»™ng"
      crontab /tmp/${USER}-crontab_backup.txt
      rm -f /tmp/${USER}-crontab_backup.txt
    fi
  fi

else
  . /etc/wptt/wptt-cau-hinh-websever-main 1
fi

check_menu_wptangtoc_active=$1
if [[ $check_menu_wptangtoc_active = "98" ]]; then
  . /etc/wptt/wptt-cau-hinh-websever-main 1
fi
